<div class="switch">
  <slot />
</div>

<style>
  .switch {
    border-left: solid 4px orange;
    padding-left: 1em;
  }
</style>

<script>
  import { getRouter } from './methods';

  export default {
    oncreate() {
      const router = getRouter(this);
      if (!router) return;

      // Clone router to create somewhat isolated context
      const context = new router.constructor(router.options);

      context.onChange = location => {
        context.active = null;
        context.set({ location });
      };

      // TODO components fire match in reverse order, defeating whole purpose of <Switch>...
      context.match = (pattern) => {
        if (context.active) return pattern.normalized === context.active;

        const matches = pattern.match(context.url) !== null;
        if (matches) context.active = pattern.normalized;

        return matches;
      };

      this.set({ context: router });
    }
  }
</script>
